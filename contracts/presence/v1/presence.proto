syntax = "proto3";

package realchat.presence.v1;

option go_package = "github.com/SARVESHVARADKAR123/RealChat/contracts/gen/go/presence/v1;presencev1";

service PresenceApi {
    rpc GetPresence(GetPresenceRequest) returns (GetPresenceResponse);
    rpc RegisterSession(RegisterSessionRequest) returns (RegisterSessionResponse);
    rpc UnregisterSession(UnregisterSessionRequest) returns (UnregisterSessionResponse);
    rpc RefreshSession(RefreshSessionRequest) returns (RefreshSessionResponse);
    rpc GetUserDevices(GetUserDevicesRequest) returns (GetUserDevicesResponse);
}

message GetPresenceRequest {
    repeated string user_ids = 1;
}

message UserPresence {
    string user_id = 1;
    bool online = 2;
    repeated string device_ids = 3;
}

message GetPresenceResponse {
    repeated UserPresence presences = 1;
}

// --- Session management messages ---

message RegisterSessionRequest {
    string user_id = 1;
    string device_id = 2;
    string instance_id = 3;
}

message RegisterSessionResponse {}

message UnregisterSessionRequest {
    string user_id = 1;
    string device_id = 2;
}

message UnregisterSessionResponse {}

message RefreshSessionRequest {
    string user_id = 1;
    string device_id = 2;
}

message RefreshSessionResponse {}

message GetUserDevicesRequest {
    string user_id = 1;
}

message DeviceInfo {
    string device_id = 1;
    string instance_id = 2;
}

message GetUserDevicesResponse {
    repeated DeviceInfo devices = 1;
}

// --- Enums and Events ---

enum PresenceStatus {
    PRESENCE_STATUS_UNSPECIFIED = 0;
    PRESENCE_STATUS_ONLINE = 1;
    PRESENCE_STATUS_OFFLINE = 2;
}

message PresenceUpdateEvent {
    string user_id = 1;
    PresenceStatus status = 2;
    int64 occurred_at = 3;
}
